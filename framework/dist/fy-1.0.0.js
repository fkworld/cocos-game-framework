!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).fy={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,e)};var e=function(){return(e=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};function o(t,n,e,o){return new(e||(e=Promise))((function(r,i){function c(t){try{u(o.next(t))}catch(t){i(t)}}function a(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(c,a)}u((o=o.apply(t,n||[])).next())}))}function r(t,n){var e,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;c;)try{if(e=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=c.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=n.call(t,c)}catch(t){i=[6,t],o=0}finally{e=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function i(t,n){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var o,r,i=e.call(t),c=[];try{for(;(void 0===n||n-- >0)&&!(o=i.next()).done;)c.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(r)throw r.error}}return c}function c(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(i(arguments[n]));return t}var a=new cc.EventTarget,u="@fy:",s=function(t){var n=t.getComponent(cc.Widget);n&&n.enabled&&(n.updateAlignment(),n.alignMode!==cc.Widget.AlignMode.ONCE&&n.alignMode!==cc.Widget.AlignMode.ON_WINDOW_RESIZE||(n.enabled=!1))},l=function(t){return o(void 0,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n){return setTimeout(n,1e3*t)}))];case 1:return n.sent(),[2]}}))}))},f=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];return t.replace(/\{([0-9]+?)\}/g,(function(t,e){var o;return null!==(o=n[e])&&void 0!==o?o:"{"+e+"}"}))},d=function(t,n){return o(void 0,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e){if(CC_EDITOR){var o="db://assets/resources/"+t;new cc.SpriteFrame instanceof n&&(o=o+"/"+C(o));var r=Editor.assetdb.remote.urlToUuid(o);cc.loader.load({type:"uuid",uuid:r},(function(n,o){n&&cc.warn(u,"载入资源失败, path="+t+", err="+n),e(n?null:o)}))}else t=S(t)+C(t),cc.loader.loadRes(t,n,(function(n,o){n&&cc.warn(u,"载入资源失败, path="+t+", err="+n),e(n?null:o)}))}))];case 1:return[2,e.sent()]}}))}))},p=cc.Intersection.lineLine,v=cc.Intersection.lineRect,_=cc.Intersection.linePolygon,h=cc.Intersection.rectRect,g=cc.Intersection.rectPolygon,y=cc.Intersection.polygonPolygon,m=cc.Intersection.polygonCircle,w=cc.Intersection.circleCircle,b=cc.Intersection.pointInPolygon,x=cc.Intersection.pointLineDistance,S=function(t){var n=t.match(/.+\/(?=[^\/]+$)/);return n?n[0]:""},C=function(t){var n=t.match(/[^\/]+(?=(\.[^\.]+)|([^\.]?)$)/);return n?n[0]:""},E=function(){function t(t){this.source=new Map,this.source=new Map(Object.entries(t))}return t.prototype.has=function(t){return this.source.has(t)},t.prototype.get=function(t){return this.source.get(t)},t.prototype.get_all=function(){return this.source},t.prototype.add=function(t,n){void 0===n&&(n=null),this.source.set(t,n)},t.prototype.del=function(t,n){this.source.delete(t)},t.prototype.log_keys=function(){return JSON.stringify(c(this.source.keys()))},t}(),O=function(){function t(t){this.id=t.id,this.state=t.initial,this.states=t.states,this.is_lock=!1}return t.prototype.lock=function(){this.is_lock=!0},t.prototype.unlock=function(){this.is_lock=!1},t.prototype.is_state=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.includes(this.state)},t.prototype.is_state_with_lock=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this.is_state.apply(this,c(t))&&!this.is_lock},t.prototype.can_go_state=function(t){return this.states[this.state].includes(t)},t.prototype.can_go_state_with_lock=function(t){return this.can_go_state(t)&&!this.is_lock},t.prototype.try_go_state=function(t){return!!this.can_go_state(t)&&(this.state=t,!0)},t.prototype.try_go_state_with_lock=function(t){return!!this.can_go_state_with_lock(t)&&(this.state=t,!0)},t}();!function(t){var n=this,e=Symbol();t.set_all=function(n,o,r){n[e]=r,o&&t.no_anima(n,o)},t.no_anima=function(t,n){cc.tween(t).set(t[e][n]).start()},t.anima=function(t,i,c){return o(n,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return void 0===c.time&&(c.time=.3),void 0===c.delay&&(c.delay=0),void 0===c.ease&&(c.ease="linear"),[4,new Promise((function(n){cc.tween(t).delay(c.delay).to(c.time,t[e][i],{easing:c.ease}).call(n).start()}))];case 1:return n.sent(),[2]}}))}))}}(t.SimpleNodeAnima||(t.SimpleNodeAnima={}));var I,M,k,P,N=function(n){t.version=new E(n),t.version.get_all().forEach((function(n,e){!n&&t.version.del(e)}))},D=function(t){var n,e,o=null!==(e=null!==(n=I.get(t))&&void 0!==n?n:cc.sys.localStorage.getItem(t))&&void 0!==e?e:""+M[t];return I.set(t,o),o},j=function(t,n){I.set(t,n),Promise.resolve().then((function(){cc.sys.localStorage.setItem(t,n)}))},R=new Map;function A(){j("music",""+k),j("sound",""+P)}var T,W,L=function(t){return o(void 0,void 0,void 0,(function(){var n,e;return r(this,(function(o){switch(o.label){case 0:return(n=R.get(t)).clip?[3,2]:(e=n,[4,d(n.url,cc.AudioClip)]);case 1:e.clip=o.sent(),n.fsm.try_go_state(n.clip?"ok":"error"),o.label=2;case 2:return R.set(t,n),[2,n]}}))}))},V=function(){function t(){}return t.get_meta_merge=function(){return this.meta_merge||(this.meta_merge=this.meta_names.reduce((function(t,n){return e({},W[n])}),{})),this.meta_merge},t.prototype.use_special=function(t){},t.prototype.use_default=function(t){},t.meta_merge=null,t}(),J=function(t,n){var e=new t,o=t.get_meta_merge()[n];return o?e.use_special(o):e.use_default(n),e},z="org/cocos2dx/javascript/",G="(Ljava/lang/String;)Ljava/lang/String;",B=new Map,F=function(){return cc.sys.isNative&&cc.sys.os==cc.sys.OS_ANDROID},H=function(){return cc.sys.isNative&&cc.sys.os==cc.sys.OS_IOS},U=function(t,n){return H()?(console.log(u,t,n),jsb.reflection.callStaticMethod("JSBinding",t+":",n)):F()?(console.log(u,t,n),jsb.reflection.callStaticMethod(z+"JSBinding",t,G,n)):null};window.NativeCallback=function(t,n){console.log(u,"NativeCallback",t,n),B.set(t,n),a.emit("@event:native/native-callback")};var Z,$,X=null,q=0,K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}(e,t),e.context=null,e}(cc.Component),Q=function(t){return o(void 0,void 0,void 0,(function(){var n,e;return r(this,(function(o){switch(o.label){case 0:return t.context.prefab?[3,2]:(n=t.context,[4,d(t.context.path,cc.Prefab)]);case 1:n.prefab=o.sent(),o.label=2;case 2:return t.context.ins?[3,4]:((e=cc.instantiate(t.context.prefab)).parent=X,e.position=cc.Vec3.ZERO,e.width=cc.winSize.width,e.height=cc.winSize.height,t.context.ins=e.getComponent(t),[4,t.context.ins.on_create()]);case 3:o.sent(),o.label=4;case 4:return[2,t.context.ins]}}))}))},Y=function(){return D("language")};t.DeDevConsole=function(t){CC_DEV&&(window[t.name]=t)},t.DeDevConsoleNamespace=function(t,n){CC_DEV&&(window[t]=n)},t.DeSetMetaContext=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n){n.meta_names=t}},t.DeSetPanelContext=function(t,n,e){return void 0===n&&(n="old"),void 0===e&&(e=0),function(o){o.context={path:t,z_index_base:e,prefab:null,ins:null,type:n,state:new O({id:"PanelState",initial:"close",states:{open:["close"],close:["open"]}})}}},t.EVENT_LANGUAGE_CHANGE="@event:text/language-change",t.EVENT_MUSIC_SWITCH_OPEN="@event:audio/music-switch-open",t.MetaBase=V,t.PanelBase=K,t.SFSM=O,t.StateTable=E,t.TAG=u,t.VERSION="1.0.0",t.VERSION_TIME="2020.5.11",t.call=U,t.call_async=function(t,n,e){return o(void 0,void 0,void 0,(function(){return r(this,(function(e){return[2,new Promise((function(e){var o=t+"/"+Date.now().toString(36)+"/"+Math.random().toFixed(5),r=Object.assign(n,{call_id:o});U(t,JSON.stringify(r));var i={};a.on("@event:native/native-callback",(function(){if(B.has(o)){var t=B.get(o);B.delete(o),a.targetOff(i),e(t)}}),i)}))]}))}))},t.change_language=function(t){j("language",t),a.emit("@event:text/language-change")},t.circleCircle=w,t.close_panel=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];return o(void 0,void 0,void 0,(function(){var e;return r(this,(function(o){switch(o.label){case 0:return t.context.state.try_go_state("close")?[4,(e=t.context.ins).on_close.apply(e,c(n))]:[2];case 1:return o.sent(),"new"===t.context.type?(t.context.ins.node.destroy(),t.context.ins=null):"old"===t.context.type&&(t.context.ins.node.active=!1),[2]}}))}))},t.do_delay=l,t.do_widget=s,t.do_widget_all=function(t){t.getComponentsInChildren(cc.Widget).forEach((function(t){return s(t.node)}))},t.do_with_frame=function(t,n,e,i){return o(void 0,void 0,void 0,(function(){return r(this,(function(o){switch(o.label){case 0:return[4,new Promise((function(o){var r=(n-1)*e,c=0,a=0;i.schedule((function(){c%e==0&&(t(a),a+=1),(c+=1)>r&&o()}),0,r)}))];case 1:return o.sent(),[2]}}))}))},t.event_center=a,t.get_color=function(t){return T[t]?cc.color().fromHEX(T[t]):(cc.warn(u,"获取color失败，key="+t),cc.Color.WHITE)},t.get_dirname=S,t.get_extname=function(t){var n=t.match(/\.[^\.]+$/);return n?n[0]:""},t.get_filename=C,t.get_language=Y,t.get_local=D,t.get_meta=J,t.get_metas=function(t){return Object.keys(t.get_meta_merge()).map((function(n){return J(t,n)}))},t.get_metas_ids=function(t){return Object.keys(t.get_meta_merge())},t.get_music_switch=function(){return k},t.get_node_wp=function(t){return t.convertToWorldSpaceAR(cc.Vec3.ZERO)},t.get_positive_mode=function(t,n){return(t%n+n)%n},t.get_sound_switch=function(){return P},t.get_template_string=f,t.get_text=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var o=CC_EDITOR?Z[$][t]:Z[Y()][t];return o?f.apply(void 0,c([o],n)):(cc.warn(u,"key不存在, key="+t),t)},t.init_editor=function(t){return o(void 0,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return function(t){CC_EDITOR&&N(t)}(t.version),function(t,n){CC_EDITOR&&!(Z=t)[$=n]&&cc.log(u,"无法载入编辑器text语言")}(t.text,t.editor_language),function(t){CC_EDITOR&&(T=t)}(t.color),[4,(e=t.meta_json_file,o(void 0,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return CC_EDITOR?[4,d(e,cc.JsonAsset)]:[3,2];case 1:W=t.sent().json,t.label=2;case 2:return[2]}}))})))];case 1:return n.sent(),[2]}var e}))}))},t.init_runtime=function(n){return o(void 0,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return function(n,e){N(n),cc.log(u,t.version.log_keys(),JSON.stringify(e))}(n.version,n.version_info),function(n){I=new Map,M=n,t.version.has("resetLocal")&&cc.sys.localStorage.clear()}(n.local),function(t){Z=t}(n.text),function(t){T=t}(n.color),function(t){R=new Map(Object.entries(t).map((function(t){var n=i(t,2),e=n[0],o=n[1],r={fsm:new O({id:"AudioSFSM",initial:"prepare",states:{prepare:["ok","error"],ok:[],error:[]}}),type:e.includes("###")?"music":"sound",url:o};return cc.audioEngine.setMaxAudioInstance(1),[e,r]}))),k="true"===D("music"),P="true"===D("sound")}(n.audio),[4,(a=n.meta_json_file,o(void 0,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,d(a,cc.JsonAsset)];case 1:return W=t.sent().json,[2]}}))})))];case 1:return e.sent(),c=n.panel_parent,X=c,cc.log(u,"初始化框架成功","1.0.0","2020.5.11"),[2]}var c,a}))}))},t.is_android=F,t.is_ios=H,t.is_native=function(){return cc.sys.isNative},t.is_prob=function(t){return Math.random()<=t},t.lineLine=p,t.linePolygon=_,t.lineRect=v,t.load_res=d,t.load_res_dir=function(t,n){return o(void 0,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e){cc.loader.loadResDir(t,n,(function(n,o){n&&cc.warn(u,"载入资源组失败, path="+t+", err="+n),e(n?null:o)}))}))];case 1:return[2,e.sent()]}}))}))},t.open_panel=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];return o(void 0,void 0,void 0,(function(){var e,o,i;return r(this,(function(r){switch(r.label){case 0:return t.context.state.try_go_state("open")?(e=q+=1,[4,Q(t)]):[2];case 1:return(o=r.sent()).node.zIndex=e+t.context.z_index_base,o.node.active=!0,[4,(i=t.context.ins).on_open.apply(i,c(n))];case 2:return r.sent(),[2]}}))}))},t.play_audio=function(t){return o(void 0,void 0,void 0,(function(){var n;return r(this,(function(e){switch(e.label){case 0:return[4,L(t)];case 1:return(n=e.sent()).fsm.is_state("error")?[2]:("music"!==n.type||k)&&("sound"!==n.type||P)?(n.id="music"===n.type?cc.audioEngine.playMusic(n.clip,!0):cc.audioEngine.playEffect(n.clip,!1),[2]):[2]}}))}))},t.pointInCircle=function(t,n){return t.sub(n.position).len()<=n.radius},t.pointInPolygon=b,t.pointLineDistance=x,t.polygonCircle=m,t.polygonPolygon=y,t.random=function(t,n,e){return void 0===e&&(e=!1),e?Math.random()*(n-t)+t:(t=Math.ceil(t),n=Math.ceil(n),Math.floor(Math.random()*(n-t)+t))},t.random_array_item=function(t){return t[Math.trunc(Math.random()*t.length)]},t.random_prob=function(t){var n=Math.random(),e=t.map((function(t,n){return{index:n,prob:t}})).sort((function(t,n){return t.prob-n.prob})),o=e.find((function(t){return(n-=t.prob)<=0}));return o?o.index:e.length-1},t.rectPolygon=g,t.rectRect=h,t.reverse_music=function(){(k=!k)?a.emit("@event:audio/music-switch-open"):cc.audioEngine.stopAll(),A()},t.reverse_sound=function(){P=!P,A()},t.set_local=j,t.set_node_by_wp=function(t,n,e){void 0===e&&(e=!1);var o=t.parent.convertToNodeSpaceAR(n);return e&&(t.position=o),o},t.stop_audio=function(t){return o(void 0,void 0,void 0,(function(){var n;return r(this,(function(e){switch(e.label){case 0:return[4,L(t)];case 1:return(n=e.sent()).fsm.is_state("error")||n.id&&cc.audioEngine.stop(n.id),[2]}}))}))},t.wait_for_do=function(t,n,e,i){return void 0===e&&(e=5),void 0===i&&(i=.5),o(void 0,void 0,void 0,(function(){var o,c;return r(this,(function(r){switch(r.label){case 0:o=0,c=0,r.label=1;case 1:return c<100?n()?(t(),[3,5]):[3,2]:[3,5];case 2:return(o+=i)>=e?[3,5]:[4,l(i)];case 3:r.sent(),r.label=4;case 4:return c+=1,[3,1];case 5:return[2]}}))}))},Object.defineProperty(t,"__esModule",{value:!0})}));
